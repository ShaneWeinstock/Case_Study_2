---
title: "CaseStudy2"
author: "Kari Theobald, Shane Weinstock, Jeremey Simpson, Gabe Gonzales"
date: "4/3/2019"
output:
  html_document:
    keep_md: yes
---
```{r, echo=TRUE, cache=TRUE}
sessionInfo()
```

```{r, echo=TRUE, cache=TRUE, include = TRUE}
#install.packages("readxl")
#install.packages("ggplot2")

library(readxl)
setwd("~/Desktop/Kari/SMU /Doing Data Science/Homework/CaseStudy2/CaseStudy2")

# 2.a ) Read the CSV file (we have xlsx) into the dataset. Output how many rows and columns 
New.Data <- read_xlsx("~/Desktop/Kari/SMU /Doing Data Science/Homework/CaseStudy2/CaseStudy2/CaseStudy2-data.xlsx")
Data <- data.frame(New.Data)
head(Data) # original import of all data 
dim(Data) # how many rows and columns in the original data set. 

# 2.b ) Change col names to less than 12 characters in the  dataframe. 
names <- c( "Age", "Attrition", "Feq.Travel", "Daily.Rate", "Department", "mlg.Home", "Education", "Ed.Field", "Emp.Count", "Emp.Number", "Env.Sat", "Gender", "HourlyRate", "Job.Invol", "Job.Level", "Title", "Satisfied", "M.S.D", "Income.mos","Rate.mos", "Jobs.Worked", "Over18", "OT", "Percent.Inc" , "Performance", "Sat.Relation", "Hours", "Stock", "Yrs.Wrkd", "Training", "Work.Life", "YOS", "YCRole","YbtwnPromo", "YwMgmt")

Data <- setNames(Data, names)

head(Data)  #check new names
summary(Data)

lapply(Data, class) # review the class of the variables in the dataframe.
# Results indicate we are operating with character and numeric classes. 

# Tidy the data to manageable dataframe. 
# Reduce the number of col in the dataframe and call the new dataframe Small.
Small<- data.frame(Data$Attrition, Data$Age, Data$Gender, Data$M.S.D, Data$YOS,   Data$Ed.Field, Data$Title, Data$Rate.mos, Data$mlg.Home)      

#Change col names in the smaller dataframe. 
names <- c( "Attrition", "Age", "Gender", "M.S.D", "YOS", "Education", "Title", "Income.mos", "mlg.Home")
Small <- setNames (Small, names)
head(Small)


# 3.a )   Is anyone under 18 participating in the study?
Over18 <- grep("N", Small$Over18)
Over18
# Response is 0. So all are considered over 18 by their response. There are 8 people who state they are 18 but we understand this response to be 18, plus a few days or months. Therefore we are leaving them in the study. 

# 3.b)  Provide descriptive Statistics on 7 variables.
summary(Small)

# 3.c)  Provide a histogram for 2 of the variables. 
# Plot Gender vs Number of Employees
plot(Small$Gender,  xlab = "Gender",   ylab= "Employees",  main="Men vs Women Ratio in Data Reviewed", ylim=c(0,1000), col=c("Yellow", "Blue"))

#Plot Number of Employee Attrition vs Total Number of Employees.
plot(Small$Attrition , xlab = "Attrition in the Workforce",   ylab= "Employees",  main="Attrition considered in the Data Reviewed", col= c("Red", "Green"))

# 3.d) Give Frequency for Gender, Education  and Occupation.
summary(Small$Gender)
# Result : Female   Male 
#           588    882 
summary(Small$Education)
# Result :  Human Resources    Life Sciences        Marketing          Medical            Other Technical Degree 
#              27              606                       159              464               82              132 
summary(Small$Title)
# Result : Number of management positions (Mfg and Research Directors, Sales Exec and Managers)
#          Total (145 + 80 + 326 + 102) = 653
#Healthcare Representative           Human Resources     Laboratory Technician                   Manager 
#                      131                        52                       259                       102 
#   Manufacturing Director         Research Director        Research Scientist           Sales Executive 
#                      145                        80                       292                       326 
#     Sales Representative 
#                       83 
#


```

```{r, echo=TRUE, cache=TRUE, include=TRUE}
#Using only the data where Attrition is True. 

setwd("~/Desktop/Kari/SMU /Doing Data Science/Homework/CaseStudy2/CaseStudy2")

New.Data <- read_xlsx("~/Desktop/Kari/SMU /Doing Data Science/Homework/CaseStudy2/CaseStudy2/CaseStudy2-data.xlsx")

Data <- data.frame(New.Data)

names <- c( "Age", "Attrition", "Feq.Travel", "Daily.Rate", "Department", "mlg.Home", "Education", "Ed.Field", "Emp.Count", "Emp.Number", "Env.Sat", "Gender", "HourlyRate", "Job.Invol", "Job.Level", "Title", "Satisfied", "M.S.D", "Income.mos","Rate.mos", "Jobs.Worked", "Over18", "OT", "Percent.Inc" , "Performance", "Sat.Relation", "Hours", "Stock", "Yrs.Wrkd", "Training", "Work.Life", "YOS", "YCRole","YbtwnPromo", "YwMgmt")

Data <- setNames(Data, names)

Small <- data.frame(Data$Attrition, Data$Age, Data$Gender, Data$M.S.D, Data$YOS,   Data$Ed.Field, Data$Title, Data$Rate.mos, Data$mlg.Home)      

#Change col names in the smaller dataframe. 
names <- c( "Attrition", "Age", "Gender", "M.S.D", "YOS", "Education", "Title", "Income.mos", "mlg.Home")
Small <- setNames (Small, names)

library(plyr)
Small$Attrition <- revalue(Small$Attrition, c("Yes"=1, "No" = 0))
head(Small$Attrition)
True.Attrition<- subset(Small, Small$Attrition==1)
head(True.Attrition)
summary(True.Attrition)
#Years of Service is minimum 0. The employee has checked this to indicate they have worked less than 1 year. 

hist(True.Attrition$mlg.Home, 
     main="Miles from Home Impacting Attrition", 
     xlab="Miles from Home",
     ylab="Number of Employees ", 
     border="blue", 
     col="green")
#The distance from home appears to impact attrition. There is right skew to the data. Indicating those living
#close to their place of employment will attrition out of the company.

hist(True.Attrition$Age,
     main="Age of Employees Impacting Attrition", 
     xlab="Employees Age (years)",
     ylab="Number of Employees",
     border = "blue",
     col="yellow")
#The Age shows a right skew with the older the age the less likely to leave a company.

# Other components possibly impacting attrition. 
library (ggplot2)
par(las=1)
Attrition.Gender <- ggplot(True.Attrition, aes(x=True.Attrition$Gender, y=True.Attrition$Title, fill = True.Attrition$Title)) + geom_bar(stat="identity", position="dodge") + xlab("Gender (Female/Male)") + ylab("Department Titles") + ggtitle("Attrition vs. Department") +   theme(plot.title = element_text(hjust = .5))

Attrition.Gender 

## Results indicate attrition is dominant in the Sales Executives and Sales Representative field for both men and women. This could largely be due to travel required. 

# Determine what is the age bracket is for each department that is showing attrition.
par(las=1)
SalesvsAge <- ggplot(True.Attrition, aes(x=True.Attrition$Age, y=True.Attrition$Title, fill = True.Attrition$Title)) + geom_bar(stat="identity", position="dodge") + xlab("Age (years)") + ylab("Department Titles") + ggtitle("Department Title vs. Age in Attrition") +   theme(plot.title = element_text(hjust = .5))

SalesvsAge

# Results indicate the sales representative are dominantly 18-40, which coincides with the overall average age for attrition which approximately 25-35 year old. We recommend to keep a younger sales team below the age of 25 or over the age of 35 to assist in reducing attrition. The workforce does have sales representative over 45 and in their mid 50's and the attrition rate of these age groups is significantly less. 

# Does being married, single or divorced have any impact on Sales Representatives. We show married people are less likely to cause attrition than single and divorced employees. What does this company have in attrition and marital status?
par(las=1)
SalesvsMSD <- ggplot(True.Attrition, aes(x=True.Attrition$M.S.D, y=True.Attrition$Age, fill = True.Attrition$Title)) + geom_bar(stat="identity", position="dodge") + xlab("Married, Single, Divorced") + ylab("Number of Employees") + ggtitle("Attrition vs. Maritial Status") +   theme(plot.title = element_text(hjust = .5))
SalesvsMSD
# Results indicate there is dominating feature in marital status for Sales Representatives in the company. In fact, we have a significant number who are married and with married people showing less probability to attrition we do conclude marital status to be a role in attrition with this company in this department/title.
```



# 4.c   Is there a relationship between age and income, color each point based off of gender? 
# Yes there is a positive relationship between age and income. Older employees tend to make higher monthly income than younger employees. 

```{r, echo=TRUE, cache=TRUE, include=TRUE}
library(ggplot2)
par(las=2)

Age2Income<-ggplot(Small, aes(x=Age, y=Income.mos, group=Gender, color =Gender)) +  geom_point(aes(color = Gender)) + stat_smooth(method="lm") + xlab("Age (years) of Employee") +  ylab("Monthly Income") + ggtitle("Workforce Income compared to Age") + theme(plot.title = element_text(hjust = 0.5))
Age2Income

```

```{r echo=TRUE, cache=TRUE, include=TRUE}

# Original Linear Regression to discover correlation between Age and Income
ageincome.lm <- lm(Income.mos ~ Age, data = Small)
ageincome.res <- resid(ageincome.lm)
summary(ageincome.lm)

# Simple Regression Model
plot(ageincome.lm)

plot(x = Small$Age, y = Small$Income.mos, ylim=c(0,50000), xlab = "Age", ylab = "Income", main = "Age vs Income")
displayDF <- data.frame(Small)

# Regression Model
## Add the regression line to the existing scatterplot
abline(ageincome.lm, col = "red")
## Create "new" data to make confidence and prediction intervals
newx <- displayDF$Age
newx <- sort(newx)
## Confidence Internal
conf <- predict(ageincome.lm, newdata = data.frame(Age = newx), interval = c("confidence"), 
                type = c("response"), level = .95)
## Prediction Interval
pred <- predict(ageincome.lm, newdata = data.frame(Age = newx), interval = c("predict"), 
                type = c("response"), level = .95)
## Add prediction and confidence intervals to the scatterplot
lines(newx, conf[,2], col = "blue", lty = 2, lwd = 2)
lines(newx, conf[,3], col = "blue", lty = 2, lwd = 2)
lines(newx, pred[,2], col = "green", lty = 2, lwd = 2)
lines(newx, pred[,3], col = "green", lty = 2, lwd = 2)

## Residual Plot
plot(Small$Age, ageincome.res, ylab = "Residuals", xlab = "Year", main = "Residuals vs. Year")
abline(0,0)

# Requires Transformation - log or log/log
Small$logAge <- log(Small$Age)
Small$logIncome <- log(Small$Income.mos)
# Checking to see if Log Income
logageincome.lm <- lm(logIncome ~ Age, data = Small)
logageincome.res <- resid(logageincome.lm)
summary(logageincome.lm)

logageincome2.lm <- lm(logIncome ~ logAge, data = Small)
summary(logageincome2.lm)
```

```{r echo=TRUE, cache=TRUE, include=TRUE}
########### do we need this??  #####
# Regression Model
plot(x = Autism$Year, y = Autism$rootPrevalence, xlim = c(1990,2002), ylim =c(-6,15), xlab = "Year", ylab = "SQRT(Prevalence)", main = "Autism Prevalence vs. Year")
displayDF <- data.frame(Autism)
## Add the regression line to the existing scatterplot
abline(Autism.lm, col = "red")
## Create "new" data to make confidence and prediction intervals
newx <- displayDF$Year
newx <- sort(newx)
## Confidence Interal
conf <- predict(Autism.lm, newdata = data.frame(Year = newx), interval = c("confidence"), 
                type = c("response"), level = .95)
## Prediction Interval
pred <- predict(Autism.lm, newdata = data.frame(Year = newx), interval = c("predict"), 
                type = c("response"), level = .95)
## Add prediction and confidence intervals to the scatterplot
lines(newx, conf[,2], col = "blue", lty = 2, lwd = 2)
lines(newx, conf[,3], col = "blue", lty = 2, lwd = 2)
lines(newx, pred[,2], col = "green", lty = 2, lwd = 2)
lines(newx, pred[,3], col = "green", lty = 2, lwd = 2)
########### the end of whatever this is ?? ########
```

### With an extremely low R-Squared and no transformation narrowing our results for comparison, it is safe to say that there is not a correlation between Age and Income across these many variables. This would likely change given we select a smaller data set or a particular job, there is simply too much variation across all 1,400 data points.
### When we review the relationship between age to income in a regression between men and women there is a small variance. Women have no significant change between age and income while men have a small increase in pay as they become older. Overall the variance is negligable at Chemicalrepo.


# 4.d What about Life Satisfaction? Is there a discernable relationship there to what?  (Trends and Observations)
#In this study we margined out the Research Scientist. We reviewed the overall satisfaction levels of Research Scientist relative to the  distance they travel to work, their Age, their monthly Income, Marital Status and Years between Promotions. 

```{r, echo=TRUE, cache=TRUE, include=TRUE}
library(ggplot2)
par(las=2)

library(plyr)
DSJob <- subset(Data, Title=="Research Scientist")

# Total Workforce comparison of Satisfaction vs miles from home.
LifeSat2Home<-ggplot(Data, aes(x=mlg.Home, y=Satisfied, group=Gender, color=Gender)) +  geom_point(aes(color = Gender)) + stat_smooth(method=lm, se=FALSE) + xlab("Distance from Home") +  ylab("Satisfied with their Job") + ggtitle("Workforce Satisfied Life by Distance to Home") + theme(plot.title = element_text(hjust = 0.5)) + coord_flip()
LifeSat2Home

# Research Scientist Satisfied vs miles from home.
LifeSat2HomeDS<-ggplot(DSJob, aes(x=mlg.Home, y=Satisfied, group=Gender, color=Gender)) +  geom_point(aes(color = Gender)) + stat_smooth(method=lm, se=FALSE) + xlab("Distance from Home") +  ylab("Satisfied with their Job") + ggtitle("Satisfied Life vs. Distance to Home for Research Scientist") + theme(plot.title = element_text(hjust = 0.5)) + coord_flip()
LifeSat2HomeDS

# Total Workforce comparison of Satisfaction vs Age of employee.
Workforce.Age<-ggplot(Data, aes(x=Age, y=Satisfied, group=Gender, color=Gender)) +  geom_point(aes(color = Gender)) + stat_smooth(method=lm, se=FALSE) + xlab("Age (years)") +  ylab("Satisfied in their Job") + ggtitle("Workforce Satisfied Life vs. Age") + theme(plot.title = element_text(hjust = 0.5)) + coord_flip()
Workforce.Age

# Research Scientist Satisfied vs Age of employee.
DS.Age<-ggplot(DSJob, aes(x=Age, y=Satisfied, group=Gender, color=Gender)) +  geom_point(aes(color = Gender)) + stat_smooth(method="lm", se=FALSE) + xlab("Age (years) of Research Scientist") +  ylab("Satisfied in their Job") + ggtitle("The Age of a Research Scientist Satisfied in their Job") + theme(plot.title = element_text(hjust = 0.5))
DS.Age

# Total Workforce comparison of Satisfaction vs Marital Status.
Workforce.Alter<-ggplot(Data, aes(x=M.S.D, y=Satisfied, group=Gender, color=Gender)) +  geom_point(aes(color = Gender)) + stat_smooth(method=lm, se=FALSE) + xlab("Married, Single, Divorced") +  ylab("Satisfied in their Job") + ggtitle("Workforce Satisfied Life vs. Marital Status") + theme(plot.title = element_text(hjust = 0.5)) + coord_flip()
Workforce.Alter

# Research Scientist Satisfied vs Marital Status.
DS.Alter<-ggplot(DSJob, aes(x=M.S.D, y=Satisfied, group=Gender, color=Gender)) +  geom_point(aes(color = Gender)) + stat_smooth(method="lm", se=FALSE) + xlab("Married, Single, Divorced") +  ylab("Satisfied in their Job") + ggtitle("Married, Single and Divorced Research Scientist, Satisfied in their Job") + theme(plot.title = element_text(hjust = 0.5)) + coord_flip()
DS.Alter

# Total Workforce comparison of Satisfaction vs Years between Promotions.
Workforce.Promo<-ggplot(Data, aes(x=YbtwnPromo, y=Satisfied, group=Gender, color=Gender)) +  geom_point(aes(color = Gender)) + stat_smooth(method=lm, se=FALSE) + xlab("Years between Promotions") +  ylab("Satisfied in Job") + ggtitle("Workforce Satisfied Life vs. Years between Promotions") + theme(plot.title = element_text(hjust = 0.5)) + coord_flip()
Workforce.Promo

# Research Scientist Satisfied vs Years between Promotions. 
DS.Promo <- ggplot(DSJob, aes(x=YbtwnPromo, y=Satisfied, group=Gender, color=Gender)) +  geom_point(aes(color = Gender)) + stat_smooth(method="lm", se=FALSE) + xlab("Years between Promotions") +  ylab("Satisfied in Job") + ggtitle("Years between Promotions vs. Satisfaction as a Research Scientist") + theme(plot.title = element_text(hjust = 0.5)) + coord_flip()
DS.Promo

# Total Workforce comparison of Satisfaction vs Income per month.
Workforce.Income<-ggplot(Data, aes(x=Income.mos, y=Satisfied, group=Gender, color=Gender)) +  geom_point(aes(color = Gender)) + stat_smooth(method=lm, se=FALSE) + xlab("Income per Month (dollars)") +  ylab("Satisfied in their Job") + ggtitle("Workforce Satisfied Life vs. Income per Month") + theme(plot.title = element_text(hjust = 0.5)) + coord_flip()
Workforce.Income

# Compare income compared to job satisfaction (male vs female).
DS.Income <- ggplot(DSJob, aes(x=Income.mos, y=Satisfied, group=Gender, color=Gender)) +  geom_point(aes(color = Gender)) + stat_smooth(method="lm", se=FALSE) + xlab(" Monthly Income") +  ylab("Satisfied in their Job") + ggtitle("Income as a Research Scientist vs. Satisfied Job for Research Scientist") + theme(plot.title = element_text(hjust = 0.5)) + coord_flip()
DS.Income

# Results indicate as a Research Scientist; men are paid a higher income overall. The more men are paid the less satisfied they are with work. The more women are paid the more satisfied they are with working. 

DS.Attrition <- ggplot(DSJob, aes(x=Attrition, y=Satisfied, group=Gender, color=Gender)) +  geom_point(aes(color = Gender)) + stat_smooth(method="lm", se=FALSE) + xlab(" Attrition") +  ylab("Satisfied in their Job") + ggtitle("Attrition vs. Satisfied Job for Research Scientist") + theme(plot.title = element_text(hjust = 0.5)) + coord_flip()
DS.Attrition
```

# 4.d  Looking only at life satisfaction data only. With Life Satisfaction overall at its maximum. 
```{r, echo=TRUE, cache=TRUE, include=TRUE}
library(ggplot2)
par(las=2)

Turnover <-  ggplot(Data, aes(x=Jobs.Worked, y=Satisfied, group=Gender, color=Gender)) +  geom_point(aes(color = Gender)) + stat_smooth(method="lm", se=FALSE) + xlab("Jobs Worked") +  ylab("Satisfied in their Job") + ggtitle("Number of Jobs worked compaired to Satisfied Job") + theme(plot.title = element_text(hjust = 0.5)) + coord_flip()
Turnover

Age.Jobs <-  ggplot(Data, aes(x=Jobs.Worked, y=Age, group=Gender, color=Gender)) +  geom_point(aes(color = Gender)) + stat_smooth(method="lm", se=FALSE) + xlab("Jobs Worked") +  ylab("Age") + ggtitle("Number of Jobs worked compaired to Age ") + theme(plot.title = element_text(hjust = 0.5)) + coord_flip()
Age.Jobs
```
# Results indicate women are happier when they start in the workforce. Women who frequently change employment demonstrate they #have a less satisfied work experience. Men however can change the jobs equal to women and maintain the same satisfaction as they #did when they took their 1st job.  There is no impact on men in being satisfied with work compared to the number of times men #change #employment. Overall women and men share equal satisfaction working when they have changed employer less than 2.5 times. 

# Results also indicate on average both women and men between the approximate age of 33 to 45 change jobs at almost the same rate. On average both men and women by the age of 40 have changed jobs almost 5 times. When compared to the maximum attrition age between 25-35 we conclude both men and women in their 30's could be working at their first job after college. We find the attrition relative to the employee taking their first job in the workforce. It is relative to note the number of jobs at a young age could be summer high school jobs and as a student working. The stronger age bracket for less attrition are those over 35, be aware, those who work between 1 to almost 8 jobs between the age of 33-45 is considered average. There is no apparent risk by this age bracket and this many number of jobs worked.
